#include "mytrips.h"
#include "rasterfont.h"
int DestroyRasterFont(RASTERFONT * rasterFont)
{
	for (int i=0;i<128;i++)	{
		if (rasterFont->c[i])	{
			if (rasterFont->c[i]->pixelarray)	{
				free(rasterFont->c[i]->pixelarray);
			}
			free(rasterFont->c[i]);
		}
	}

	return 1;
}

//Font stuff
int LoadRasterFont(RASTERFONT * rasterFont)
{
	memset(rasterFont, 0, sizeof(RASTERFONT));


	rasterFont->approxheight = 7;
	unsigned char * pixelarray;


	//Spacebar
	rasterFont->c[32] = malloc(sizeof(RASTERCHAR));
	rasterFont->c[32]->width=4;
	rasterFont->c[32]->height=7;
	rasterFont->c[32]->pixelarray = NULL;

	unsigned char letterC[]={	//7x7
		0x00, 0x26, 0xc5, 0xff, 0xff, 0xdd, 0x6b,
		0x00, 0xd1, 0xdd, 0x42, 0x00, 0x9c, 0x9c,
		0x26, 0xff, 0x6b, 0x00, 0x00, 0x00, 0x00,
		0x42, 0xff, 0x42, 0x00, 0x00, 0x00, 0x00,
		0x26, 0xff, 0x6b, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xd1, 0xdd, 0x42, 0x00, 0x9c, 0x9c,
		0x00, 0x26, 0xc5, 0xff, 0xff, 0xdd, 0x6b
		};

	unsigned char letterM[]={	//7x7
		0xff, 0xb8, 0x00, 0x00, 0xaa, 0xff, 0x42,
		0xff, 0xf4, 0x26, 0x00, 0xf4, 0xff, 0x42,
		0xff, 0xc5, 0x8d, 0x7d, 0xc5, 0xff, 0x42,
		0xff, 0x7d, 0xd1, 0xc5, 0x7d, 0xff, 0x42,
		0xff, 0x00, 0xf4, 0xf4, 0x00, 0xff, 0x42,
		0xff, 0x00, 0xaa, 0xaa, 0x00, 0xff, 0x42,
		0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0x42
		};



	unsigned char lettero[]={	//6x7
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x26, 0xdd, 0xff, 0xff, 0x8d, 0x00,

		0xaa, 0xdd, 0x00, 0x7d, 0xf4, 0x00,
		0xb8, 0x9c, 0x00, 0x00, 0xff, 0x42,
		0xaa, 0xdd, 0x00, 0x7d, 0xf4, 0x00,
		0x26, 0xdd, 0xff, 0xff, 0x8d, 0x00

	};

	unsigned char number0[]={	//6x7
		0x00, 0xd1, 0xff, 0xff, 0x8d, 0x00,
		0x7d, 0xf4, 0x42, 0x7d, 0xff, 0x26,
		0xaa, 0xd1, 0x00, 0x00, 0xff, 0x6b,
		0xb8, 0xd1, 0x00, 0x00, 0xff, 0x8d,
		0xaa, 0xd1, 0x00, 0x00, 0xff, 0x6b,
		0x7d, 0xf4, 0x42, 0x7d, 0xff, 0x26,
		0x00, 0xd1, 0xff, 0xff, 0x9c, 0x00
	};

	unsigned char number1[]={	//5x7
		0x00, 0x42, 0xf4, 0x00, 0x00,
		0x8d, 0xff, 0xff, 0x00, 0x00,
		0x00, 0x42, 0xff, 0x00, 0x00,
		0x00, 0x42, 0xff, 0x00, 0x00,
		0x00, 0x42, 0xff, 0x00, 0x00,
		0x00, 0x42, 0xff, 0x00, 0x00,
		0x8d, 0xff, 0xff, 0xff, 0x8d
	};

	unsigned char number2[]={	//5x7
		0x9c, 0xff, 0xff, 0xdd, 0x26,
		0xb8, 0x6b, 0x26, 0xe9, 0x9c,
		0x00, 0x00, 0x00, 0xdd, 0x9c,
		0x00, 0x00, 0x8d, 0xdd, 0x26,
		0x00, 0x8d, 0xdd, 0x42, 0x00,
		0xb8, 0xdd, 0x26, 0x00, 0x00,
		0xe9, 0xff, 0xff, 0xff, 0xd1
	};

	unsigned char number3[]={	//5x7
		0xb8, 0xff, 0xff, 0xdd, 0x42,
		0x00, 0x00, 0x00, 0xdd, 0xaa,
		0x00, 0x00, 0x26, 0xe9, 0x8d,
		0x00, 0x8d, 0xff, 0xdd, 0x00,
		0x00, 0x00, 0x00, 0xc5, 0xaa,
		0xc5, 0x58, 0x00, 0xdd, 0xc5,
		0xaa, 0xff, 0xff, 0xdd, 0x42
	};

	unsigned char number4[]={	//6x7
		0x00, 0x00, 0x42, 0xf4, 0x9c, 0x00,
		0x00, 0x26, 0xe9, 0xff, 0x9c, 0x00,
		0x00, 0xc5, 0xaa, 0xd1, 0x9c, 0x00,
		0xaa, 0xdd, 0x00, 0xd1, 0x9c, 0x00,
		0xe9, 0xff, 0xff, 0xff, 0xff, 0x9c,
		0x00, 0x00, 0x00, 0xd1, 0x9c, 0x00,
		0x00, 0x00, 0x00, 0xd1, 0x9c, 0x00
	};

	unsigned char number5[]={	//6x7
		0x00, 0xff, 0xff, 0xff, 0xff, 0x42,
		0x00, 0xff, 0x42, 0x00, 0x00, 0x00,
		0x00, 0xff, 0xff, 0xff, 0x9c, 0x00,
		0x00, 0x00, 0x00, 0x8d, 0xff, 0x26,
		0x00, 0x00, 0x00, 0x00, 0xff, 0x6b,
		0x8d, 0xb8, 0x00, 0x8d, 0xf4, 0x26,
		0x58, 0xdd, 0xff, 0xff, 0x8d, 0x00
	};

	unsigned char number6[]={	//6x7
		0x00, 0x9c, 0xff, 0xff, 0x9c, 0x00,
		0x7d, 0xff, 0x8d, 0x00, 0x00, 0x00,
		0xc5, 0xb8, 0x00, 0x00, 0x00, 0x00,
		0xe9, 0xff, 0xff, 0xff, 0x9c, 0x00,
		0xdd, 0x9c, 0x00, 0x7d, 0xff, 0x26,
		0xaa, 0xd1, 0x00, 0x7d, 0xff, 0x26,
		0x26, 0xdd, 0xff, 0xff, 0x8d, 0x00
	};

	unsigned char number7[]={	//6x7
		0xd1, 0xff, 0xff, 0xff, 0xff, 0x42,
		0x00, 0x00, 0x00, 0x6b, 0xd1, 0x00,
		0x00, 0x00, 0x00, 0xe9, 0x6b, 0x00,
		0x00, 0x00, 0x8d, 0xd1, 0x00, 0x00,
		0x00, 0x00, 0xe9, 0x6b, 0x00, 0x00,
		0x00, 0x8d, 0xd1, 0x00, 0x00, 0x00,
		0x00, 0xe9, 0x6b, 0x00, 0x00, 0x00
	};

	unsigned char number8[]={	//6x7
		0x26, 0xdd, 0xff, 0xff, 0xb8, 0x00,
		0x9c, 0xf4, 0x26, 0x7d, 0xff, 0x42,
		0x6b, 0xf4, 0x8d, 0x6b, 0xe9, 0x00,
		0x26, 0xdd, 0xb8, 0xff, 0xaa, 0x00,
		0xaa, 0xc5, 0x00, 0x26, 0xf4, 0x7d,
		0xaa, 0xe9, 0x26, 0x58, 0xff, 0x7d,
		0x42, 0xdd, 0xff, 0xff, 0xaa, 0x00
	};

	unsigned char number9[]={	//6x7
		0x00, 0xb8, 0xff, 0xff, 0xb8, 0x00,
		0x7d, 0xf4, 0x42, 0x42, 0xf4, 0x7d,
		0x8d, 0xf4, 0x42, 0x00, 0xd1, 0x9c,
		0x26, 0xdd, 0xff, 0xff, 0xff, 0x9c,
		0x00, 0x00, 0x00, 0x00, 0xf4, 0x9c,
		0x00, 0x00, 0x00, 0x6b, 0xf4, 0x26,
		0x00, 0xd1, 0xff, 0xdd, 0x6b, 0x00
	};


	unsigned char punctuationFullStop[]={	//2x7
		0x00, 0x00,
		0x00, 0x00,
		0x00, 0x00,
		0x00, 0x00,
		0x00, 0x00,
		0xff, 0x6b,
		0xff, 0x6b
	};

	unsigned char punctuationColon[]={	//3x7
		0x00, 0x00, 0x00,
		0x00, 0x00, 0x00,
		0x42, 0xff, 0x6b,
		0x42, 0xff, 0x6b,
		0x00, 0x00, 0x00,
		0x42, 0xff, 0x6b,
		0x42, 0xff, 0x6b
	};



	rasterFont->c[65] = malloc(sizeof(RASTERCHAR));
	rasterFont->c[65]->width=7;
	rasterFont->c[65]->height=7;
	rasterFont->c[65]->pixelarray=malloc(7*7);

	pixelarray=rasterFont->c[65]->pixelarray;


	pixelarray[0*7+0] = 0x00;
	pixelarray[0*7+1] = 0x00;
	pixelarray[0*7+2] = 0x3a;
	pixelarray[0*7+3] = 0xff;
	pixelarray[0*7+4] = 0x55;
	pixelarray[0*7+5] = 0x00;
	pixelarray[0*7+6] = 0x00;

	pixelarray[1*7+0] = 0x00;
	pixelarray[1*7+1] = 0x00;
	pixelarray[1*7+2] = 0x82;
	pixelarray[1*7+3] = 0x94;
	pixelarray[1*7+4] = 0xa7;
	pixelarray[1*7+5] = 0x00;
	pixelarray[1*7+6] = 0x00;

	pixelarray[2*7+0] = 0x00;
	pixelarray[2*7+1] = 0x0b;
	pixelarray[2*7+2] = 0xd9;
	pixelarray[2*7+3] = 0x22;
	pixelarray[2*7+4] = 0xd9;
	pixelarray[2*7+5] = 0x16;
	pixelarray[2*7+6] = 0x00;

	pixelarray[3*7+0] = 0x00;
	pixelarray[3*7+1] = 0x47;
	pixelarray[3*7+2] = 0xa7;
	pixelarray[3*7+3] = 0x00;
	pixelarray[3*7+4] = 0x82;
	pixelarray[3*7+5] = 0x55;
	pixelarray[3*7+6] = 0x00;

	pixelarray[4*7+0] = 0x00;
	pixelarray[4*7+1] = 0x82;
	pixelarray[4*7+2] = 0xFF;
	pixelarray[4*7+3] = 0xFF;
	pixelarray[4*7+4] = 0xFF;
	pixelarray[4*7+5] = 0xa7;
	pixelarray[4*7+6] = 0x00;

	pixelarray[5*7+0] = 0x0b;
	pixelarray[5*7+1] = 0xff;
	pixelarray[5*7+2] = 0x16;
	pixelarray[5*7+3] = 0x00;
	pixelarray[5*7+4] = 0x0b;
	pixelarray[5*7+5] = 0xd9;
	pixelarray[5*7+6] = 0x22;

	pixelarray[6*7+0] = 0x55;
	pixelarray[6*7+1] = 0xa7;
	pixelarray[6*7+2] = 0x00;
	pixelarray[6*7+3] = 0x00;
	pixelarray[6*7+4] = 0x00;
	pixelarray[6*7+5] = 0x82;
	pixelarray[6*7+6] = 0x55;


	rasterFont->c[66] = malloc(sizeof(RASTERCHAR));
	rasterFont->c[66]->width=7;
	rasterFont->c[66]->height=7;
	rasterFont->c[66]->pixelarray=malloc(7*7);

	pixelarray=rasterFont->c[66]->pixelarray;


	pixelarray[0*7+0] = 0x42;
	pixelarray[0*7+1] = 0xff;
	pixelarray[0*7+2] = 0xff;
	pixelarray[0*7+3] = 0xff;
	pixelarray[0*7+4] = 0xf4;
	pixelarray[0*7+5] = 0x58;
	pixelarray[0*7+6] = 0x00;

	pixelarray[1*7+0] = 0x42;
	pixelarray[1*7+1] = 0xff;
	pixelarray[1*7+2] = 0x6b;
	pixelarray[1*7+3] = 0x00;
	pixelarray[1*7+4] = 0xd1;
	pixelarray[1*7+5] = 0xb8;
	pixelarray[1*7+6] = 0x00;

	pixelarray[2*7+0] = 0x42;
	pixelarray[2*7+1] = 0xff;
	pixelarray[2*7+2] = 0x6b;
	pixelarray[2*7+3] = 0x00;
	pixelarray[2*7+4] = 0xdd;
	pixelarray[2*7+5] = 0x9c;
	pixelarray[2*7+6] = 0x00;

	pixelarray[3*7+0] = 0x42;
	pixelarray[3*7+1] = 0xff;
	pixelarray[3*7+2] = 0xff;
	pixelarray[3*7+3] = 0xff;
	pixelarray[3*7+4] = 0xf4;
	pixelarray[3*7+5] = 0x9c;
	pixelarray[3*7+6] = 0x00;

	pixelarray[4*7+0] = 0x42;
	pixelarray[4*7+1] = 0xff;
	pixelarray[4*7+2] = 0x6b;
	pixelarray[4*7+3] = 0x00;
	pixelarray[4*7+4] = 0x6b;
	pixelarray[4*7+5] = 0xff;
	pixelarray[4*7+6] = 0x58;

	pixelarray[5*7+0] = 0x42;
	pixelarray[5*7+1] = 0xff;
	pixelarray[5*7+2] = 0x6b;
	pixelarray[5*7+3] = 0x00;
	pixelarray[5*7+4] = 0x7d;
	pixelarray[5*7+5] = 0xff;
	pixelarray[5*7+6] = 0x58;

	pixelarray[6*7+0] = 0x42;
	pixelarray[6*7+1] = 0xff;
	pixelarray[6*7+2] = 0xff;
	pixelarray[6*7+3] = 0xff;
	pixelarray[6*7+4] = 0xff;
	pixelarray[6*7+5] = 0x9c;
	pixelarray[6*7+6] = 0x00;


	rasterFont->c['C'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['C']->width=7;
	rasterFont->c['C']->height=7;
	rasterFont->c['C']->pixelarray=malloc(7*7);
	pixelarray=rasterFont->c['C']->pixelarray;
	memcpy(pixelarray, letterC, 7*7);

	rasterFont->c['M'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['M']->width=7;
	rasterFont->c['M']->height=7;
	rasterFont->c['M']->pixelarray=malloc(7*7);
	pixelarray=rasterFont->c['M']->pixelarray;
	memcpy(pixelarray, letterM, 7*7);



	rasterFont->c['o'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['o']->width=6;
	rasterFont->c['o']->height=7;
	rasterFont->c['o']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['o']->pixelarray;
	memcpy(pixelarray, lettero, 6*7);



	rasterFont->c['0'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['0']->width=6;
	rasterFont->c['0']->height=7;
	rasterFont->c['0']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['0']->pixelarray;
	memcpy(pixelarray, number0, 6*7);

	rasterFont->c['1'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['1']->width=5;
	rasterFont->c['1']->height=7;
	rasterFont->c['1']->pixelarray=malloc(5*7);
	pixelarray=rasterFont->c['1']->pixelarray;
	memcpy(pixelarray, number1, 5*7);

	rasterFont->c['2'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['2']->width=5;
	rasterFont->c['2']->height=7;
	rasterFont->c['2']->pixelarray=malloc(5*7);
	pixelarray=rasterFont->c['2']->pixelarray;
	memcpy(pixelarray, number2, 5*7);

	rasterFont->c['3'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['3']->width=5;
	rasterFont->c['3']->height=7;
	rasterFont->c['3']->pixelarray=malloc(5*7);
	pixelarray=rasterFont->c['3']->pixelarray;
	memcpy(pixelarray, number3, 5*7);

	rasterFont->c['4'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['4']->width=6;
	rasterFont->c['4']->height=7;
	rasterFont->c['4']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['4']->pixelarray;
	memcpy(pixelarray, number4, 6*7);

	rasterFont->c['5'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['5']->width=6;
	rasterFont->c['5']->height=7;
	rasterFont->c['5']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['5']->pixelarray;
	memcpy(pixelarray, number5, 6*7);

	rasterFont->c['6'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['6']->width=6;
	rasterFont->c['6']->height=7;
	rasterFont->c['6']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['6']->pixelarray;
	memcpy(pixelarray, number6, 6*7);

	rasterFont->c['7'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['7']->width=6;
	rasterFont->c['7']->height=7;
	rasterFont->c['7']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['7']->pixelarray;
	memcpy(pixelarray, number7, 6*7);

	rasterFont->c['8'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['8']->width=6;
	rasterFont->c['8']->height=7;
	rasterFont->c['8']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['8']->pixelarray;
	memcpy(pixelarray, number8, 6*7);

	rasterFont->c['9'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['9']->width=6;
	rasterFont->c['9']->height=7;
	rasterFont->c['9']->pixelarray=malloc(6*7);
	pixelarray=rasterFont->c['9']->pixelarray;
	memcpy(pixelarray, number9, 6*7);


	rasterFont->c['.'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c['.']->width=2;
	rasterFont->c['.']->height=7;
	rasterFont->c['.']->pixelarray=malloc(2*7);
	pixelarray=rasterFont->c['.']->pixelarray;
	memcpy(pixelarray, punctuationFullStop, 2*7);

	rasterFont->c[':'] = malloc(sizeof(RASTERCHAR));
	rasterFont->c[':']->width=3;
	rasterFont->c[':']->height=7;
	rasterFont->c[':']->pixelarray=malloc(3*7);
	pixelarray=rasterFont->c[':']->pixelarray;
	memcpy(pixelarray, punctuationColon, 3*7);




	return 1;
}

RASTERCHAR * plotChar(BM * bm, RASTERFONT * rasterfont, int x, int y, unsigned char character, COLOUR * colourText)
{
	RASTERCHAR * rasterchar;

	int row,col;

	if (rasterfont->c[character] == NULL)	{
		return NULL;
	}

	rasterchar = rasterfont->c[character];
	if (rasterchar->pixelarray==NULL)
		return rasterchar;
	for (col=0; col < rasterchar->width; col++)	{
		for (row=0; row < rasterchar->height; row++)	{
			plot(bm, x+col, y+row, rasterchar->pixelarray[col+row*rasterchar->width], colourText);
		}
	}

	return rasterchar;
}


int bitmapText(BM * bm, RASTERFONT *rasterfont, int x, int y, char * szText, COLOUR * colourText)
{
	RASTERCHAR * rc;
	int n;

	n= strlen(szText);
	for (int i=0; i<n; i++)	{
		rc = plotChar(bm, rasterfont, x, y, szText[i], colourText);
		if (rc)
			x+=rc->width;
	}

	return 1;
}


int fontGetStringWidth(RASTERFONT *rasterfont, char *szText)
{
	RASTERCHAR * rc;
	int n;
	int width=0;

	n= strlen(szText);
	for (int i=0; i<n; i++)	{
		width+=rasterfont->c[szText[i]]->width;
	}

	return width;
}
